<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Everspeak - Talk to Your Loved Ones</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Everspeak</h1>
      <p>Keep the conversation going with those you love</p>
    </header>

    <!-- Grounding Banner -->
    <div class="grounding-banner" id="grounding-banner" data-testid="grounding-banner">
      <p>
        EverSpeak is a memory-based companion. It's not the real person, not a ghost, and not a therapist. 
        It's here to help you reflect using your own memories.
      </p>
      <button class="banner-dismiss" id="banner-dismiss" data-testid="button-dismiss-banner">Got it</button>
    </div>

    <main class="panels">
      <!-- Persona Panel -->
      <section class="panel persona-panel">
        <h2>Persona</h2>
        
        <div class="persona-selector">
          <label for="persona-dropdown">Select Persona:</label>
          <select id="persona-dropdown" data-testid="select-persona">
            <option value="">-- Choose a persona --</option>
          </select>
        </div>

        <div class="persona-info" id="persona-info">
          <p class="info-item"><strong>Name:</strong> <span id="info-name" data-testid="text-persona-name">-</span></p>
          <p class="info-item"><strong>Relationship:</strong> <span id="info-relationship" data-testid="text-persona-relationship">-</span></p>
          <p class="info-item"><strong>Description:</strong> <span id="info-description" data-testid="text-persona-description">-</span></p>
        </div>

        <div class="settings-section" id="settings-section" style="display: none;">
          <h3>Persona Settings</h3>
          <p class="settings-description">Calibrate communication style and boundaries</p>
          
          <div class="form-group">
            <label for="tone-mode-select">Default Tone Mode</label>
            <select id="tone-mode-select" class="settings-select" data-testid="select-tone-mode">
              <option value="auto">Auto</option>
              <option value="comforting">Comforting</option>
              <option value="honest">Honest</option>
              <option value="playful">Playful</option>
              <option value="balanced">Balanced</option>
            </select>
          </div>

          <div class="slider-group">
            <label for="humor-slider">Humor <span id="humor-value" class="slider-value">3</span></label>
            <input type="range" id="humor-slider" min="0" max="5" step="0.5" value="3" class="calibration-slider" data-testid="slider-humor">
          </div>

          <div class="slider-group">
            <label for="honesty-slider">Honesty <span id="honesty-value" class="slider-value">3</span></label>
            <input type="range" id="honesty-slider" min="0" max="5" step="0.5" value="3" class="calibration-slider" data-testid="slider-honesty">
          </div>

          <div class="slider-group">
            <label for="sentimentality-slider">Sentimentality <span id="sentimentality-value" class="slider-value">3</span></label>
            <input type="range" id="sentimentality-slider" min="0" max="5" step="0.5" value="3" class="calibration-slider" data-testid="slider-sentimentality">
          </div>

          <div class="slider-group">
            <label for="energy-slider">Energy <span id="energy-value" class="slider-value">3</span></label>
            <input type="range" id="energy-slider" min="0" max="5" step="0.5" value="3" class="calibration-slider" data-testid="slider-energy">
          </div>

          <div class="slider-group">
            <label for="advice-slider">Advice-giving <span id="advice-value" class="slider-value">2</span></label>
            <input type="range" id="advice-slider" min="0" max="5" step="0.5" value="2" class="calibration-slider" data-testid="slider-advice">
          </div>

          <div class="boundaries-group">
            <label class="boundary-label">Boundaries</label>
            <div class="checkbox-item">
              <input type="checkbox" id="avoid-regret-spirals" checked data-testid="checkbox-avoid-regret">
              <label for="avoid-regret-spirals">Avoid regret spirals</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="no-paranormal-language" checked data-testid="checkbox-no-paranormal">
              <label for="no-paranormal-language">No paranormal language</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="soften-sensitive-topics" checked data-testid="checkbox-soften-sensitive">
              <label for="soften-sensitive-topics">Soften sensitive topics</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="prefer-reassurance" checked data-testid="checkbox-prefer-reassurance">
              <label for="prefer-reassurance">Prefer reassurance</label>
            </div>
          </div>

          <button class="btn-save-settings" id="save-settings-btn" data-testid="button-save-settings">Save Settings</button>
          <div class="settings-feedback" id="settings-feedback" style="display: none;"></div>
        </div>

        <div class="snapshots-section" id="snapshots-section" style="display: none;">
          <h3>Snapshots</h3>
          <p class="snapshots-description">Save versions of this persona to restore later</p>
          <button class="btn-create-snapshot" id="create-snapshot-btn" data-testid="button-create-snapshot">Create Snapshot</button>
          <div id="snapshots-list" data-testid="list-snapshots">
            <p class="placeholder">No snapshots yet</p>
          </div>
        </div>

        <div class="create-persona-form">
          <h3>Create New Persona</h3>
          <form id="persona-form">
            <div class="form-group">
              <label for="persona-name">Name *</label>
              <input type="text" id="persona-name" data-testid="input-persona-name" required>
            </div>
            <div class="form-group">
              <label for="persona-relationship">Relationship</label>
              <input type="text" id="persona-relationship" data-testid="input-persona-relationship" placeholder="e.g., Brother, Mother, Friend">
            </div>
            <div class="form-group">
              <label for="persona-description">Description</label>
              <textarea id="persona-description" data-testid="input-persona-description" rows="3" placeholder="Tell us about this person..."></textarea>
            </div>
            <button type="submit" data-testid="button-save-persona">Save Persona</button>
          </form>
        </div>
      </section>

      <!-- Memory Panel -->
      <section class="panel memory-panel">
        <h2>Memories</h2>
        
        <div id="memories-list" data-testid="list-memories">
          <p class="placeholder">Select a persona to view memories</p>
        </div>

        <div class="add-memory-form">
          <h3>Add Memory</h3>
          <form id="memory-form">
            <div class="form-group">
              <label for="memory-category">Category *</label>
              <select id="memory-category" data-testid="select-memory-category" required>
                <option value="">-- Choose category --</option>
                <option value="humor">Humor</option>
                <option value="regrets">Regrets</option>
                <option value="childhood">Childhood</option>
                <option value="advice">Advice</option>
                <option value="personality">Personality</option>
                <option value="misc">Misc</option>
              </select>
            </div>
            <div class="form-group">
              <label for="memory-text">Memory *</label>
              <textarea id="memory-text" data-testid="input-memory-text" rows="3" required placeholder="Describe this memory..."></textarea>
            </div>
            <div class="form-group">
              <label for="memory-weight">Weight (0.1 - 5.0)</label>
              <input type="number" id="memory-weight" data-testid="input-memory-weight" min="0.1" max="5.0" step="0.1" value="1.0">
            </div>
            <button type="submit" data-testid="button-add-memory">Add Memory</button>
          </form>
        </div>
      </section>

      <!-- Chat Panel -->
      <section class="panel chat-panel">
        <h2>Chat</h2>
        
        <div class="chat-messages" id="chat-messages" data-testid="chat-messages">
          <p class="placeholder">Select a persona and start chatting</p>
        </div>

        <!-- Healthy Use Nudge -->
        <div class="healthy-use-nudge" id="healthy-use-nudge" data-testid="healthy-use-nudge" style="display: none;">
          <p>
            You've been talking for a while. It might help to take a short break, stretch, or write down how you're feeling. 
            I'll be here when you come back.
          </p>
        </div>

        <!-- Strict Mode Indicator -->
        <div class="strict-mode-indicator" id="strict-mode-indicator" data-testid="strict-mode-indicator" style="display: none;">
          <span class="strict-mode-text">Strict mode: staying closer to their real personality.</span>
          <a href="#" id="strict-mode-turn-off" data-testid="link-strict-mode-turn-off">Turn off</a>
        </div>

        <div class="chat-input-area">
          <form id="chat-form">
            <div class="chat-controls">
              <div class="form-group">
                <label for="emotional-state">Emotional State</label>
                <select id="emotional-state" data-testid="select-emotional-state">
                  <option value="neutral">Neutral</option>
                  <option value="sad">Sad</option>
                  <option value="reflective">Reflective</option>
                  <option value="anxious">Anxious</option>
                  <option value="excited">Excited</option>
                  <option value="nostalgic">Nostalgic</option>
                </select>
              </div>
              <div class="form-group">
                <label for="tone-mode">Tone Mode</label>
                <select id="tone-mode" data-testid="select-chat-tone-mode">
                  <option value="auto">Auto</option>
                  <option value="comforting">Comforting</option>
                  <option value="honest">Honest</option>
                  <option value="playful">Playful</option>
                  <option value="balanced">Balanced</option>
                </select>
              </div>
            </div>
            <div class="chat-input-wrapper">
              <textarea id="chat-input" data-testid="input-chat-message" rows="2" placeholder="Type your message..." required></textarea>
              <button type="submit" data-testid="button-send-message">Send</button>
            </div>
          </form>
        </div>
      </section>
    </main>
  </div>

  <script src="/app.js"></script>
</body>
</html>
